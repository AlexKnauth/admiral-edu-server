#lang racket/base

(require "../ct-session.rkt"
         web-server/http/request-structs)
(require rackunit "umass-shib.rkt")

(define sample-headers
  '((host . "localhost:8080") 
    (referer . "https://webauth.oit.umass.edu/idp/profile/SAML2/Redirect/SSO") 
    (cookie . "_shibsession_64656661756c7468747470733a2f2f63733232302e63732e756d6173732e6564752f73686962626f6c657468=_b0afe1a1d34336ec92d48433889be81d") 
    (shib-session-id . "_b0afe1a1d34336ec92d48433889be81d") 
    (shib-session-index . "bce13a999aa8d21785c8cf8e25ad36e43acfa110451666e32ec43ab39390a92a") 
    (shib-identity-provider . "https://webauth.oit.umass.edu/idp/shibboleth") 
    (shib-authentication-method . "urn:oasis:names:tc:SAML:2.0:ac:classes:PasswordProtectedTransport") 
    (shib-authentication-instant . "2014-05-15T13:18:40.646Z") 
    (shib-authncontext-class . "urn:oasis:names:tc:SAML:2.0:ac:classes:PasswordProtectedTransport") 
    (shib-authncontext-decl . "") 
    (shib-assertion-count . "") 
    (eppn . "jcollard@umass.edu") 
    (affiliation . "") 
    (unscoped-affiliation . "") 
    (entitlement . "") 
    (targeted-id . "") 
    (persistent-id . "https://webauth.oit.umass.edu/idp/shibboleth!https://cs220.cs.umass.edu/shibboleth!g9fE406uRhDV1OxQFlGWM23xrN8=") 
    (uid . "jcollard") 
    (fclogouturl . "https://webauth.oit.umass.edu/Logout") 
    (transientid . "_e40a7dcd1ce5c79aee168a6adc3c8096") 
    (edupersonprimaryaffiliation . "Student") 
    (umaprimaryaccount . "jcollard") 
    (shib-application-id . "default") 
    (remote_user . "jcollard@umass.edu") 
    (x-forwarded-for . "128.119.40.196") 
    (x-forwarded-host . "cs220.cs.umass.edu") 
    (x-forwarded-server . "ip-172-31-46-158.us-west-2.compute.internal") 
    (connection . "Keep-Alive")))

(check-equal? (ct-session "cmpsci220" "jcollard") (headers->session sample-headers))